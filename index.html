<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>Shadowrocket â†’ v2rayN è½¬æ¢å™¨</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
    textarea { width: 100%; padding: 10px; margin: 10px 0; font-size: 14px; }
    button { padding: 8px 16px; margin: 5px 5px 15px 0; font-size: 14px; }
  </style>
</head>
<body>
  <h2>ğŸ§Š Shadowrocket èŠ‚ç‚¹ JSON â†’ v2rayN å¯ç”¨é“¾æ¥</h2>
  
  <label>ç²˜è´´ Shadowrocket å¯¼å‡ºçš„èŠ‚ç‚¹ JSONï¼š</label>
  <textarea id="input" rows="12" placeholder='ç²˜è´´ Shadowrocket åˆ†äº«å‡ºæ¥çš„ JSON'></textarea>

  <div>
    <button onclick="convert()">è½¬æ¢</button>
    <button onclick="copyResult()">å¤åˆ¶ç»“æœ</button>
    <button onclick="clearAll()">æ¸…ç©º</button>
  </div>

  <label>è½¬æ¢åçš„é“¾æ¥ï¼š</label>
  <textarea id="output" rows="3" readonly></textarea>

  <script>
    function convert() {
      const raw = document.getElementById("input").value.trim();
      if (!raw) return alert("è¯·è¾“å…¥ JSON é…ç½®");

      try {
        const data = JSON.parse(raw);
        let result = "";

        const type = (data.type || "").toLowerCase();

        if (type === "vmess") {
          const config = {
            v: "2",
            ps: data.title || data.ps || "vmess-node",
            add: data.host || data.add || "",
            port: data.port || "",
            id: data.uuid || data.id || "",
            aid: data.alterId || "0",
            net: data.obfs === "websocket" ? "ws" : "tcp",
            type: "none",
            host: data.obfsParam || data.host || "",
            path: data.path || "",
            tls: data.tls ? "tls" : ""
          };

          const json = JSON.stringify(config);
          const base64 = btoa(unescape(encodeURIComponent(json)));
          result = "vmess://" + base64;

        } else if (type === "vless") {
          const uuid = data.uuid || ""; // æ­£ç¡®ä½¿ç”¨ uuid
          const host = data.host || "";
          const port = data.port || "";
          const peer = data.peer || host;
          const publicKey = data.publicKey || "";
          const shortId = data.shortId || "";
          const title = data.title || "vless-node";

          const query = [
            "encryption=none",
            "security=reality",
            "type=none",
            "headerType=none",
            "fp=chrome",
            publicKey ? "pbk=" + encodeURIComponent(publicKey) : "",
            shortId ? "sid=" + encodeURIComponent(shortId) : "",
            peer ? "sni=" + encodeURIComponent(peer) : "",
            (publicKey && shortId) ? "flow=xtls-rprx-vision" : ""
          ].filter(Boolean).join("&");

          result = `vless://${uuid}@${host}:${port}?${query}#${encodeURIComponent(title)}`;

        } else {
          alert("æš‚ä¸æ”¯æŒçš„ç±»å‹ï¼š" + type);
          return;
        }

        document.getElementById("output").value = result;

      } catch (e) {
        alert("æ— æ•ˆçš„ JSONï¼Œè§£æå¤±è´¥ï¼");
      }
    }

    function copyResult() {
      const output = document.getElementById("output");
      if (!output.value) return alert("æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹");
      output.select();
      document.execCommand("copy");
      alert("å·²å¤åˆ¶");
    }

    function clearAll() {
      document.getElementById("input").value = "";
      document.getElementById("output").value = "";
    }
  </script>
</body>
</html>